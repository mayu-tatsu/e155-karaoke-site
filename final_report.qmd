---
title: "Final Report"
---

## Project Overview
SUMMARY
Names and short bios of team members with link to personal website or LinkedIn profile.
Abstract which briefly describes the main purpose and operation of the system.

All project code (software and HDL) included in Git repository
Git repository contains a README.md file to describe the main elements of the project and where they are found.


## Project Specifications
* Design allows the user to choose a song through external hardware
* Design detects input frequencies between 300 to 2000 Hz
* Design scores the user’s singing by comparing detected and expected notes
* Design plays back the expected song through a speaker as reference
* Design utilizes a pitch and delay media format (as seen in Lab 4)
* Displays properly-timed lyrics on an LCD screen
* LCD display does not flicker


## Bill of Materials
| **Part Name**                         | **Part Number**                                                                                   | **Quantity** | **Price**                                                   | **Vendor**                                                  |
|:-------------------------------------:|:-------------------------------------------------------------------------------------------------:|:------------:|:-----------------------------------------------------------:|:-----------------------------------------------------------:|
| Adafruit PDM MEMS Microphone Breakout | [MP34DT01-M](https://www.st.com/en/audio-ics/mp34dt01-m.html)                                     | 1            | $11.23 *($4.95 part, $6.28 shipping + tax)*                 | [Adafruit](https://www.adafruit.com/product/3492)           |
| Hosyond I2C 2004 LCD Module           | [HD44780U](https://dfimg.dfrobot.com/enshop/image/data/DFR0154/LCD2004%20hd44780%20Datasheet.pdf) | 1            | $26.32 *($16.99 part, $6.99 shipping, $2.34 estimated tax)* | [Amazon](https://www.amazon.com/gp/product/B0C1G9GBRZ?th=1) |
| **TOTAL**                             |                                                                                                   |              | $37.55                                                      |                                                             |
: Bill of materials {#tbl-bom}


## Design Details

![Design Overview](images/final_overview_diagram.jpg){#fig-final-overview-diagram}

### FPGA Design Overview
what is the FPGA doing along with main design features.

### MCU Design Overview
description of what the MCU is doing.

### New Non-Trivial Hardware
New hardware listed in section with description
New hardware described with notes about the features to be implemented and how they go beyond the previous material covered in the course.


## Technical Documentation
The source code for this project can be found in the associated [GitHub repository]().

### Block Diagram
![Block diagram](){#fig-final-block-diagram}

The block diagram in [Figure 1](#fig-final-block-diagram) depicts the general architecture implied by the SystemVerilog code.

### Schematic
![Schematic](){#fig-final-schematic width=80%}

[Figure 2](#fig-final-schematic) above depicts 

Overall, the microphone and FPGA interfacing was done in accordance with the [MP34DT01-M datasheet](https://github.com/mayu-tatsu/e155-karaoke-site/blob/main/files/mp34dt01-m.pdf).
The most prominent feature of note is the tying of the LR port to ground, as that configures a DOUT signal pattern of valid data when the CLK signal is low and high impedance when CLK is high.

### Flowchart {#sec-flowchart}
![Flowchart](){#fig-final-flowchart}

The [Figure 3](#fig-final-flowchart) flowchart provides a detailed overview of the microcontroller's most significant routines.

First and foremost, the *main* loop's primary jobs are to 1) configure the MCU and all of its relevant peripherals, 2) continuously apply an FFT to the detected audio samples — which are, again, transmitted to the controller via SPI — in order to determine the dominant frequencies, and 3) output the corresponding note.
This notably requires the help of two custom functions, *frequency_determiner* and *note_determiner*.
The former makes use of the ARM math library to actually perform the FFT calculations (with some pre-processing work done to ensure greater accuracy and resolution), after which an *fft_calculations_complete* flag is set.
Meanwhile, the latter comprises what is essentially a look-up table to output the dominant frequency as a note that is in human-readable terms.
Finally, the *DMA1_Channel2_IRQHandler* deals with any interrupts that trigger as a result of the SPI-to-DMA-transfer-complete flag being set.
More specifically, it waits until the *fft_calculations_complete* flag is high to copy the contents of the SPI data register (i.e. whatever audio sample the FPGA is sending over at the time) to a second buffer, named *input_signal*, for *frequency_determiner* to subsequently process; then, it resets the *fft_calculations_complete* so that the process may begin anew.


## Verification
Various means of verification were used to ensure the project's accuracy, including the following simulation waveforms and oscilloscope traces, as well as actual experimentation with the hardware itself.

### Testbench Simulation {#sec-testbench-simulation}


### Oscilloscope Traces


## Results
Results: What are the main results of your project.
Results section clearly and quantitatively outlines the key performance aspects of the design with commentary to explain the design decisions.

Short video showcasing a demonstration of the project
Photos documenting final design


## References
References: Citation (and hyperlinks where relevant) to any outside resources that were referenced in the design of the project.
References are formatted with a clean and consistent format.


## Acknowledgements
